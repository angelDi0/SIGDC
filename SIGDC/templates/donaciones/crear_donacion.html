<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Crear donación - SIGDC</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-light bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand" href="{% url 'usuarios:menu' %}">SIGDC</a>
      <div>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'usuarios:logout' %}">Salir</a>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <h3>Registrar donación</h3>
    <form id="form-donacion" class="mt-3">
      {% csrf_token %}
      <div class="mb-3">
        <label class="form-label">Tipo</label>
        <input id="tipo" name="tipo" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Origen</label>
        <input id="origen" name="origen" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Monto</label>
        <input id="monto" name="monto" type="number" step="any" min="0" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Descripción</label>
        <textarea id="descripcion" name="descripcion" class="form-control" rows="4"></textarea>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success">Registrar donación</button>
      </div>
    </form>
    <div id="result" class="mt-3"></div>
  </main>

  <script>
    function getCookie(name) {
      const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return v ? v.pop() : '';
    }
    const csrftoken = getCookie('csrftoken');

    document.getElementById('form-donacion').addEventListener('submit', async function(e){
      e.preventDefault();
      const data = {
        tipo: document.getElementById('tipo').value,
        origen: document.getElementById('origen').value,
        monto: parseFloat(document.getElementById('monto').value) || null,
        descripcion: document.getElementById('descripcion').value
      };
      try {
        const resp = await fetch('/donaciones/api/donaciones/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
          },
          body: JSON.stringify(data)
        });
        if (!resp.ok) throw resp;
        const created = await resp.json();
        document.getElementById('result').innerText = 'Donación creada: ' + created.id;
      } catch(e) {
        console.error(e);
        document.getElementById('result').innerText = 'Error al crear donación.';
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>